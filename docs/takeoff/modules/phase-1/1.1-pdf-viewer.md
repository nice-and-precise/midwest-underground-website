# Module 1.1: PDF Plan Viewer

## Overview

This module implements the foundational PDF viewing capabilities for the takeoff system. It provides users with the ability to upload construction plan PDFs, navigate through multi-page documents, and perform basic viewing operations (zoom, pan, page navigation).

This is the first module of Phase 1 and establishes the canvas foundation upon which measurement tools and annotations will be overlaid in subsequent modules.

## Outcome

A fully functional PDF viewer integrated into `dashboard/takeoff.html` that enables:
- PDF file upload (drag-and-drop and file picker)
- Multi-page PDF rendering using PDF.js
- Zoom controls (zoom in, zoom out, fit to width, fit to page, custom zoom %)
- Pan/scroll navigation within zoomed documents
- Page navigation (previous, next, jump to page, page thumbnail sidebar)
- Document information display (filename, page count, current page)

## Key Behaviors

### PDF Upload
- Accept PDF files via drag-and-drop zone or file input button
- Validate file type (must be .pdf)
- Display file size and page count after load
- Show loading indicator during PDF processing
- Handle upload errors gracefully (invalid file, too large, corrupted PDF)

### PDF Rendering
- Use PDF.js library (Mozilla's PDF rendering engine) via CDN
- Render current page to HTML5 canvas element
- Maintain aspect ratio during rendering
- Support high-DPI displays (scale canvas for retina screens)
- Clear canvas when loading new page or new document

### Zoom Controls
- Zoom in (+25% increments)
- Zoom out (-25% increments)
- Fit to width (auto-calculate zoom to match container width)
- Fit to page (auto-calculate zoom to show entire page)
- Custom zoom input (10% to 500%)
- Display current zoom level in UI
- Preserve zoom level when changing pages

### Pan Navigation
- Enable mouse drag to pan when zoomed in
- Show scrollbars when content exceeds viewport
- Support keyboard arrow keys for panning
- Reset pan position when changing pages

### Page Navigation
- Previous/Next buttons with keyboard shortcuts (Arrow Left/Right)
- Jump to page input field
- Page thumbnail sidebar (optional, can load on demand)
- Display current page number and total pages (e.g., "Page 3 of 15")
- Disable Previous button on page 1, Next button on last page

## Allowed Files

**Create:**
- `dashboard/takeoff.html` - Main takeoff interface with PDF viewer
- `dashboard/js/pdf-viewer.js` - PDF.js integration and viewer controls
- `dashboard/css/takeoff.css` - Styles for takeoff interface

**Modify:**
- None (self-contained module)

## Dependencies

**External Libraries:**
- PDF.js (v3.11.174 or later) via CDN
  - `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js`
  - `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js`

**Internal Dependencies:**
- None (first module of Phase 1)

## Skills Needed

- PDF.js API knowledge
  - `pdfjsLib.getDocument()` for loading PDFs
  - Page rendering to canvas
  - Document metadata extraction
- HTML5 Canvas manipulation
  - Canvas scaling and rendering
  - High-DPI canvas support
  - Canvas clearing and redrawing
- File Upload API
  - FileReader API for reading uploaded files
  - Drag-and-drop event handling
  - File validation
- DOM manipulation
  - Dynamic UI updates
  - Button state management
  - Event listener binding
- CSS layout
  - Flexbox for viewer layout
  - Canvas sizing and positioning
  - Responsive design for different screen sizes

## Constraints

### Technology Constraints
- Use only static HTML/JS/CSS (no framework)
- PDF.js must be loaded from CDN (no npm/build process)
- No backend server for file storage (files loaded from user's device)
- Store PDF file reference in browser memory (not persisted until Module 1.4)

### Performance Constraints
- Render pages on demand (don't pre-render all pages)
- Clear canvas when switching pages to free memory
- Limit maximum file size (recommend 50MB max)
- Show loading indicators for operations > 500ms

### UI/UX Constraints
- Follow existing dashboard design patterns
- Use existing dashboard CSS variables for colors
- Maintain consistent button styles with other dashboard pages
- Ensure keyboard accessibility (all controls reachable via keyboard)

### Browser Compatibility
- Must work in Chrome 90+, Firefox 88+, Edge 90+, Safari 14+
- Gracefully degrade if PDF.js fails to load
- Display error messages for unsupported browsers

## Data Structures

### PDF Document State

```javascript
// Stored in pdf-viewer.js module scope
const viewerState = {
  pdfDoc: null,              // PDF.js document object
  currentPage: 1,            // Current page number (1-indexed)
  totalPages: 0,             // Total page count
  zoom: 1.0,                 // Current zoom level (1.0 = 100%)
  fileName: '',              // Uploaded file name
  fileSize: 0,               // File size in bytes
  canvas: null,              // Canvas element reference
  ctx: null,                 // Canvas 2D context
  renderTask: null,          // Current render task (for cancellation)
  isPanning: false,          // Whether user is currently panning
  panStart: { x: 0, y: 0 },  // Pan gesture start coordinates
};
```

### Page Render Options

```javascript
// Options passed to PDF.js render method
const renderOptions = {
  canvasContext: ctx,
  viewport: page.getViewport({ scale: zoom }),
  background: 'transparent', // Allow CSS background to show through
};
```

## Implementation Notes

**To be added after implementation:**
- Actual library versions used
- Performance benchmarks (load time, render time)
- Browser compatibility test results
- Accessibility audit results
- Any deviations from planned approach

## Known Limitations

**To be added after implementation:**
- Maximum file size tested
- Maximum page count tested
- Known browser-specific issues
- Performance bottlenecks identified
- Accessibility gaps (if any)

---

**Module Status:** Not Started
**Phase:** Phase 1 - Takeoff Core
**Dependencies:** None (foundation module)
**Next Module:** 1.2 - Measurement Tools (will overlay Fabric.js canvas on PDF viewer)
